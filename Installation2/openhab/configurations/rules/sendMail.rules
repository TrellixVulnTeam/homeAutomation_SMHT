// import the decimal type as we refer to it in a rule
import org.openhab.core.library.types.DecimalType
import org.openhab.core.library.types.*
import org.openhab.core.persistance.*
import org.openhab.model.script.actions.*

//
rule "Send On Mail"
when 
    Item Light_gTradgarden_WaterPump received command ON
then 
    sendMail("bjorn.lonne@gmail.com","Water Pump", "Water Pump is turned ON")
end

// 
rule "Send Off Mail"
when 
    Item Light_gTradgarden_WaterPump received command OFF
then
    sendMail("bjorn.lonne@gmail.com","Water Pump", "Water Pump is turned OFF") 
end

//-----------------------------------------------------------------------
// Rule to turn on/off a switch connected to a Heater.
//   ON : temperature gets below a defined level
//   OFF: temperature is above a defined level
//-----------------------------------------------------------------------
rule "House temperature trigger"
when
    Item gHuset_Temperature changed
then
    if ((gHuset_Temperature.state < 10) && (gHuset_Heater1.state == OFF)) {
        logInfo("House Temperature changed", "temperature below 10. Turn on heater 1. Temp: "+gHuset_Temperature.state)
        sendCommand(gHuset_Heater1, ON)
        sendMail("bjorn.lonne@gmail.com","House Temperature warning", "Temperature in house below 10 degrees. Turning ON Heater 1. Temp:"+gHuset_Temperature.state)
    }
    else {
        if ((gHuset_Temperature.state > 15) && (gHuset_Heater1.state == ON)) {
            logInfo("House Temperature changed", "temperature above 15 and gHusetHeater1 is ON. Temperature: "+gHuset_Temperature.state)
            sendCommand(gHuset_Heater1, OFF)
            sendMail("bjorn.lonne@gmail.com","House Temperature warning", "Temperature in house above 15 degrees. Turning OFF Heater 1. Temp:"+gHuset_Temperature.state)
        }
        else {
            logInfo("House Temperature changed", "temperature changed but Heater not changed. Temperature: "+gHuset_Temperature.state)
        } 
    }
end
// Step two is to add an action that powers on a heater
//    if (gHuset_Temperature.state < 10 && ChargerOutlet.state == OFF) {
//    if (gHuset_Temperature.state < 10 && gHuset_Heater1.state == OFF) {
//        logInfo("detached", "Detected house temp below 10 degrees !!. Should turn ON heater")
//        // sendCommand(ChargerOutlet, ON)
//        sendMail("bjorn.lonne@gmail.com","House Temperature warning", "Temperature in house is below 10 degrees: "+gHuset_Temperature.state)
//        //sendXMPP("myemail@gmail.com", "detached garage outlet changed to "+ChargerOutlet.state +"  temperature: "+gHuset_Temperature.state)
//    }
//    else {
//    if (gHuset_Temperature.state >= 15 && ChargerOutlet.state == ON) {
//        if (gHuset_Temperature.state >= 15 && gHuset_Heater1 == ON) {
//            logInfo("detached", "Detected house temp higher than 15 !!. Should turn OFF heater")
//            //sendCommand(ChargerOutlet, OFF)
//            //sendXMPP("myemail@gmail.com", "detached garage outlet switched off.  Temperature: "+gHuset_Temperature.state)
//            sendMail("bjorn.lonne@gmail.com","House Temperature warning", "Temperature in house is above 15 degrees: "+gHuset_Temperature.state)
//        }
//    }
//end
